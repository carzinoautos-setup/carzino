<!DOCTYPE html>
<html>
<head>
    <title>Debug Carzino API Connection</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .error { background: #fee; color: #c33; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .success { background: #efe; color: #060; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .info { background: #eef; color: #006; padding: 10px; border-radius: 4px; margin: 10px 0; }
        button { background: #007cba; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 4px; overflow: auto; }
    </style>
</head>
<body>
    <h1>üîç Debug Carzino API Connection</h1>
    
    <div class="info">
        <strong>Current Domain:</strong> <span id="currentDomain"></span><br>
        <strong>Target WordPress:</strong> https://env-uploadbackup62225-czdev.kinsta.cloud
    </div>

    <button onclick="testCORS()">Test CORS Headers</button>
    <button onclick="testWPSite()">Test WordPress Site</button>
    <button onclick="testAPIEndpoint()">Test API Endpoint</button>
    <button onclick="testWithCreds()">Test With Credentials</button>
    
    <div id="results"></div>

    <script>
        document.getElementById('currentDomain').textContent = window.location.origin;
        
        function addResult(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = message;
            results.appendChild(div);
        }

        async function testCORS() {
            addResult('üåê Testing CORS headers...', 'info');
            
            try {
                const response = await fetch('https://env-uploadbackup62225-czdev.kinsta.cloud/', {
                    method: 'HEAD',
                    mode: 'cors'
                });
                addResult('‚úÖ WordPress site is reachable via CORS', 'success');
            } catch (error) {
                addResult(`‚ùå CORS Error: ${error.message}`, 'error');
                addResult('üîß <strong>Fix:</strong> Make sure Snippet #5 (CORS Headers) is active in WordPress', 'error');
            }
        }

        async function testWPSite() {
            addResult('üåê Testing WordPress site availability...', 'info');
            
            try {
                const response = await fetch('https://env-uploadbackup62225-czdev.kinsta.cloud/wp-json/');
                const data = await response.json();
                addResult('‚úÖ WordPress REST API is working', 'success');
                addResult(`<pre>API Info: ${JSON.stringify(data, null, 2)}</pre>`, 'success');
            } catch (error) {
                addResult(`‚ùå WordPress API Error: ${error.message}`, 'error');
            }
        }

        async function testAPIEndpoint() {
            addResult('üõí Testing WooCommerce API endpoint...', 'info');
            
            try {
                const response = await fetch('https://env-uploadbackup62225-czdev.kinsta.cloud/wp-json/wc/v3/');
                
                if (response.status === 401) {
                    addResult('‚úÖ WooCommerce API endpoint exists (401 = needs auth)', 'success');
                } else {
                    const data = await response.json();
                    addResult('‚úÖ WooCommerce API is accessible', 'success');
                    addResult(`<pre>API Response: ${JSON.stringify(data, null, 2)}</pre>`, 'success');
                }
            } catch (error) {
                addResult(`‚ùå WooCommerce API Error: ${error.message}`, 'error');
                addResult('üîß <strong>Fix:</strong> Make sure WooCommerce plugin is active', 'error');
            }
        }

        async function testWithCreds() {
            addResult('üîë Testing with API credentials...', 'info');
            
            // Note: In production, these would come from environment variables
            // For testing, you'll need to replace these with your actual credentials
            const testUrl = 'https://env-uploadbackup62225-czdev.kinsta.cloud/wp-json/wc/v3/products?per_page=1&consumer_key=YOUR_KEY&consumer_secret=YOUR_SECRET';
            
            addResult('‚ö†Ô∏è <strong>Manual Test Required:</strong>', 'info');
            addResult(`
                <p>Copy this URL and replace YOUR_KEY and YOUR_SECRET with your actual API credentials:</p>
                <pre>${testUrl}</pre>
                <p>Then test it in a new browser tab. If it works, the API is fine.</p>
            `, 'info');
        }

        // Auto-run basic tests
        window.onload = function() {
            addResult('üöÄ Starting automatic diagnostics...', 'info');
            setTimeout(testCORS, 500);
            setTimeout(testWPSite, 1000);
            setTimeout(testAPIEndpoint, 1500);
        };
    </script>
</body>
</html>
